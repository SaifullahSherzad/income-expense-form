<!DOCTYPE html>
<html lang="ps" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯ Ù¼Ø±ÛŒÙ„Ø± ÙˆØ±ÚÙ†ÙŠ Ø­Ø³Ø§Ø¨ ÙÙˆØ±Ù…</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Naskh Arabic', Arial, sans-serif;
            background: linear-gradient(135deg, #0a0515 0%, #020203 40%, #030712 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            direction: rtl;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            width: 100%;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 24px;
            padding: 40px 30px;
            box-shadow: 0 8px 32px rgba(139, 92, 246, 0.1);
            animation: slideDown 0.8s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            animation: fadeInUp 0.6s ease 0.1s both;
        }

        .logo-box {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #8b5cf6, #3b82f6, #ec4899);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            animation: float 4s ease-in-out infinite;
            box-shadow: 0 20px 50px rgba(139, 92, 246, 0.5);
            flex-shrink: 0;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: 28px;
            background: linear-gradient(to left, #a78bfa, #60a5fa, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .job-selector {
            display: none;
        }

        .job-selector.active {
            display: block;
            animation: fadeInUp 0.6s ease;
        }

        .job-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .job-btn {
            padding: 20px;
            background: linear-gradient(to bottom-right, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.05));
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 16px;
            color: #fff;
            cursor: pointer;
            text-align: right;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .job-btn:hover {
            border-color: rgba(139, 92, 246, 0.6);
            background: linear-gradient(to bottom-right, rgba(139, 92, 246, 0.2), rgba(59, 130, 246, 0.1));
            transform: translateY(-5px);
        }

        .job-btn .emoji {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .job-btn .name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .password-form {
            display: none;
        }

        .password-form.active {
            display: block;
            animation: fadeInUp 0.6s ease;
        }

        .form-group {
            margin-bottom: 20px;
            animation: fadeInUp 0.6s ease;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #a78bfa;
        }

        input, textarea {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            color: #fff;
            font-family: inherit;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: rgba(139, 92, 246, 0.6);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.2);
        }

        input::placeholder, textarea::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        button {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(to left, #ec4899, #3b82f6, #8b5cf6);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 107, 107, 0.3);
            color: #ffb3b3;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 107, 107, 0.6);
        }

        .current-job {
            background: linear-gradient(to right, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.05));
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: fadeInUp 0.6s ease;
        }

        .current-job span {
            font-size: 12px;
            color: rgba(167, 139, 250, 0.7);
        }

        .current-job-name {
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            margin-top: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a0033 0%, #0a0515 100%);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #fff;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
            font-size: 14px;
        }

        .summary-item label {
            color: #a78bfa;
        }

        .summary-item span {
            color: #fff;
        }

        .error-msg {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid rgba(255, 107, 107, 0.3);
            color: #ffb3b3;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .success-msg {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #86efac;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 600px) {
            .container {
                padding: 30px 20px;
            }

            h1 {
                font-size: 22px;
            }

            .job-grid {
                grid-template-columns: 1fr;
            }

            .header {
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Job Selection Screen -->
        <div id="jobSelector" class="job-selector active">
            <div class="header">
                <div class="logo-box">TR</div>
                <h1>Ø¯ ÙˆØ±ÚÙ†ÙŠ Ø­Ø³Ø§Ø¨</h1>
            </div>
            <p style="color: #a78bfa; margin-bottom: 30px; font-size: 14px;">Ú©Ø§Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ú“Ø¦</p>
            <div class="job-grid">
                <button class="job-btn" onclick="selectJob('saudi', 'Ø³Ø¹ÙˆØ¯ÙŠ Ø­Ø³Ø§Ø¨', 'saudi123')">
                    <div class="emoji">ğŸ‡¸ğŸ‡¦</div>
                    <div class="name">Ø³Ø¹ÙˆØ¯ÙŠ Ø­Ø³Ø§Ø¨</div>
                    <div style="font-size: 12px; color: #a78bfa;">Ø¯ Ø³Ø¹ÙˆØ¯ÙŠ Ú©Ø§Ø±</div>
                </button>
                <button class="job-btn" onclick="selectJob('brooklyn', 'Ø¨Ø±ÙˆÚ©Ù„ÛŒÙ† Ø­Ø³Ø§Ø¨', 'brooklyn123')">
                    <div class="emoji">ğŸ—½</div>
                    <div class="name">Ø¨Ø±ÙˆÚ©Ù„ÛŒÙ† Ø­Ø³Ø§Ø¨</div>
                    <div style="font-size: 12px; color: #a78bfa;">Ø¯ Ø¨Ø±ÙˆÚ©Ù„ÛŒÙ† Ú©Ø§Ø±</div>
                </button>
                <button class="job-btn" onclick="selectJob('mobile', 'Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø­Ø³Ø§Ø¨', 'mobile123')">
                    <div class="emoji">ğŸ“±</div>
                    <div class="name">Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø­Ø³Ø§Ø¨</div>
                    <div style="font-size: 12px; color: #a78bfa;">Ø¯ Ù…ÙˆØ¨Ø§ÛŒÙ„ÙˆÙ†Ùˆ Ú©Ø§Ø±</div>
                </button>
                <button class="job-btn" onclick="selectJob('home', 'Ú©ÙˆØ± Ù…ØµØ§Ø±Ù', 'home123')">
                    <div class="emoji">ğŸ </div>
                    <div class="name">Ú©ÙˆØ± Ù…ØµØ§Ø±Ù</div>
                    <div style="font-size: 12px; color: #a78bfa;">Ø¯ Ú©ÙˆØ± ÙˆØ±ÚÙ†ÙŠ</div>
                </button>
            </div>
        </div>

        <!-- Password Form Screen -->
        <div id="passwordForm" class="password-form">
            <div class="header" style="margin-bottom: 40px;">
                <div class="logo-box">TR</div>
                <h1>Ø¯ ÙˆØ±ÚÙ†ÙŠ Ø­Ø³Ø§Ø¨</h1>
            </div>
            <div class="form-group">
                <label>Ù¾Ø§Ø³ÙˆØ±Ú‰ Ø¯Ø§Ø®Ù„ Ú©Ú“Ø¦</label>
                <input type="password" id="passwordInput" placeholder="Ù¾Ø§Ø³ÙˆØ±Ú‰ ÙˆÙ„ÛŒÚ©Ø¦..." autofocus>
                <div id="passwordError" class="error-msg" style="display: none;"></div>
            </div>
            <div class="button-group">
                <button class="btn-primary" onclick="checkPassword()">Ø¯Ø®ÙˆÙ„</button>
                <button class="btn-secondary" onclick="backToJobs()">Ø´Ø§ØªÙ‡</button>
            </div>
        </div>

        <!-- Main Form Screen -->
        <div id="mainForm" class="password-form">
            <div class="header">
                <div class="logo-box">TR</div>
                <h1>Ø¯ ÙˆØ±ÚÙ†ÙŠ Ø­Ø³Ø§Ø¨ ÙÙˆØ±Ù…</h1>
            </div>

            <div class="current-job">
                <div>
                    <span>ÙØ¹Ù„ÛŒ Ú©Ø§Ø±</span>
                    <div class="current-job-name" id="currentJobName"></div>
                </div>
                <button class="btn-secondary" style="width: auto;" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
            </div>

            <div id="formError" class="error-msg" style="display: none;"></div>
            <div id="formSuccess" class="success-msg" style="display: none;"></div>

            <form id="accountForm">
                <div class="form-group">
                    <label>Ù†ÛŒÙ¼Ù‡</label>
                    <input type="date" id="date" required>
                </div>

                <div class="form-group">
                    <label>Ø¹Ø§Ø¦Ø¯</label>
                    <input type="number" id="income" placeholder="0" value="0">
                </div>

                <div class="form-group">
                    <label>Ù…ØµØ§Ø±Ù</label>
                    <input type="number" id="expense" placeholder="0" value="0">
                </div>

                <div class="form-group">
                    <label>ØªÙØµÛŒÙ„</label>
                    <input type="text" id="detail" placeholder="Ø¯ Ú©Ø§Ø± ØªÙØµÛŒÙ„...">
                </div>

                <div class="form-group">
                    <label>ÛŒØ§Ø¯Ø§ÚšØª</label>
                    <textarea id="note" placeholder="ÛŒØ§Ø¯Ø§ÚšØª..." rows="4"></textarea>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-primary" onclick="submitForm()">Ø«Ø¨ØªÙˆÙ„</button>
                    <button type="button" class="btn-secondary" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
                </div>
            </form>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirmModal" class="modal">
            <div class="modal-content">
                <div class="modal-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªØµØ¯ÛŒÙ‚ Ú©Ø±ÛŒÚº</div>
                <div id="summary"></div>
                <div class="button-group" style="margin-top: 30px;">
                    <button class="btn-primary" onclick="confirmSubmit()">ØªØµØ¯ÛŒÙ‚</button>
                    <button class="btn-secondary" onclick="closeModal()">Ø¨Ø¯Ù„</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const GOOGLE_SHEETS_URL = "https://script.google.com/macros/s/AKfycbxMuzcGNbDxdvzOaOw-n1hY-Mbr2OsxYEBVDqnC2TP35baYP3lkXbo0nyF87LltSVHB/exec";
        
        let currentJob = null;
        let currentPassword = null;
        let formDataForSubmit = null;

        // Set today's date
        document.getElementById('date').valueAsDate = new Date();

        function selectJob(jobId, jobName, password) {
            currentJob = { id: jobId, name: jobName };
            currentPassword = password;
            document.getElementById('jobSelector').classList.remove('active');
            document.getElementById('passwordForm').classList.add('active');
            document.getElementById('passwordInput').focus();
        }

        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            const errorDiv = document.getElementById('passwordError');

            if (password === currentPassword) {
                errorDiv.style.display = 'none';
                localStorage.setItem('currentJob', JSON.stringify(currentJob));
                showMainForm();
            } else {
                errorDiv.textContent = 'Ù¾Ø§Ø³ÙˆØ±Ú‰ ØºÙ„Ø· Ø¯Ø¦';
                errorDiv.style.display = 'block';
                document.getElementById('passwordInput').value = '';
            }
        }

        function backToJobs() {
            document.getElementById('passwordForm').classList.remove('active');
            document.getElementById('jobSelector').classList.add('active');
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordError').style.display = 'none';
            currentJob = null;
        }

        function showMainForm() {
            document.getElementById('passwordForm').classList.remove('active');
            document.getElementById('mainForm').classList.add('active');
            document.getElementById('currentJobName').textContent = currentJob.name;
        }

        function submitForm() {
            const date = document.getElementById('date').value;
            const income = document.getElementById('income').value || '0';
            const expense = document.getElementById('expense').value || '0';
            const detail = document.getElementById('detail').value;
            const note = document.getElementById('note').value;

            formDataForSubmit = { date, income, expense, detail, note };
            showConfirmation(formDataForSubmit);
        }

        function showConfirmation(data) {
            const summary = `
                <div class="summary-item">
                    <label>Ù†ÛŒÙ¼Ù‡:</label>
                    <span>${data.date}</span>
                </div>
                <div class="summary-item">
                    <label>Ø¹Ø§Ø¦Ø¯:</label>
                    <span>${data.income}</span>
                </div>
                <div class="summary-item">
                    <label>Ù…ØµØ§Ø±Ù:</label>
                    <span>${data.expense}</span>
                </div>
                <div class="summary-item">
                    <label>ØªÙØµÛŒÙ„:</label>
                    <span>${data.detail || '-'}</span>
                </div>
                <div class="summary-item">
                    <label>ÛŒØ§Ø¯Ø§ÚšØª:</label>
                    <span>${data.note || '-'}</span>
                </div>
            `;
            document.getElementById('summary').innerHTML = summary;
            document.getElementById('confirmModal').classList.add('active');
        }

        async function confirmSubmit() {
            try {
                const btn = event.target;
                btn.disabled = true;
                btn.innerHTML = '<span class="loading"></span> ...Ù„ÙŠÚ–Ù„ Ú©ÛÚ–ÙŠ';

                const dateParts = formDataForSubmit.date.split('-');
                const formattedDate = `${dateParts[2]}-${dateParts[1]}-${dateParts[0]}`;

                const params = new URLSearchParams({
                    date: formattedDate,
                    job: currentJob.name,
                    income: formDataForSubmit.income,
                    expense: formDataForSubmit.expense,
                    detail: formDataForSubmit.detail,
                    note: formDataForSubmit.note,
                });

                const response = await fetch(GOOGLE_SHEETS_URL + '?' + params.toString());
                const result = await response.text();

                if (result.includes('OK') || response.ok) {
                    document.getElementById('formSuccess').textContent = 'âœ… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨Ø±ÛŒØ§Ù„ÛŒØªÙˆØ¨ Ø³Ø±Ù‡ Ø«Ø¨Øª Ø´ÙˆÙ„!';
                    document.getElementById('formSuccess').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('accountForm').reset();
                        document.getElementById('date').valueAsDate = new Date();
                        document.getElementById('formSuccess').style.display = 'none';
                        closeModal();
                    }, 2000);
                } else {
                    throw new Error('Ø®Ø±Ø§Ø¨ÛŒ');
                }
            } catch (error) {
                document.getElementById('formError').textContent = 'âŒ Ø¯ Ù„ÛŒÚ–Ù„Ùˆ Ø³ØªÙˆÙ†Ø²Ù‡: ' + error.message;
                document.getElementById('formError').style.display = 'block';
            } finally {
                event.target.disabled = false;
                event.target.innerHTML = 'ØªØµØ¯ÛŒÙ‚';
            }
        }

        function closeModal() {
            document.getElementById('confirmModal').classList.remove('active');
        }

        function logout() {
            localStorage.removeItem('currentJob');
            document.getElementById('mainForm').classList.remove('active');
            document.getElementById('passwordForm').classList.remove('active');
            document.getElementById('jobSelector').classList.add('active');
            document.getElementById('accountForm').reset();
            currentJob = null;
            currentPassword = null;
        }

        // Load session on page load
        window.addEventListener('load', () => {
            const saved = localStorage.getItem('currentJob');
            if (saved) {
                try {
                    currentJob = JSON.parse(saved);
                    // Note: password would need to be re-entered for security
                    showMainForm();
                } catch (e) {
                    localStorage.removeItem('currentJob');
                }
            }
        });
    </script>
</body>
</html>
